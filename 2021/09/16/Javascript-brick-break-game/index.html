<!DOCTYPE html>
<html lang="en,zh-TW,default">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P7J0KE07RD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-P7J0KE07RD');
</script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"doug0849.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="完成作品 自己本身滿愛玩遊戲的，自己開始學JavaScript之後，主要都是在學如何開發網頁及如何使用JavaScript來操作網頁，透過路由來新增、讀取、更新、刪除資料庫資料…，但心裡一直想，JavaScript的運用很廣泛，不如自己來查資料看看如何來製作一款簡易的小遊戲，也來接觸不同層面的開發運用。 於似乎我找到MDN上的一個打磚塊教學，就決定先從這個小遊戲開始練習學習並記錄過程。">
<meta property="og:type" content="article">
<meta property="og:title" content="Javascript-打磚塊遊戲實作">
<meta property="og:url" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/index.html">
<meta property="og:site_name" content="想要邊撸鐵邊學CODE的DOUG">
<meta property="og:description" content="完成作品 自己本身滿愛玩遊戲的，自己開始學JavaScript之後，主要都是在學如何開發網頁及如何使用JavaScript來操作網頁，透過路由來新增、讀取、更新、刪除資料庫資料…，但心裡一直想，JavaScript的運用很廣泛，不如自己來查資料看看如何來製作一款簡易的小遊戲，也來接觸不同層面的開發運用。 於似乎我找到MDN上的一個打磚塊教學，就決定先從這個小遊戲開始練習學習並記錄過程。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/1.png">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/2.png">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/3.png">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/4.png">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/5.png">
<meta property="og:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/6.png">
<meta property="article:published_time" content="2021-09-16T07:40:43.000Z">
<meta property="article:modified_time" content="2021-09-16T07:40:43.000Z">
<meta property="article:author" content="Doug 道">
<meta property="article:tag" content="技術筆記">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="Game">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/1.png">

<link rel="canonical" href="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Javascript-打磚塊遊戲實作 | 想要邊撸鐵邊學CODE的DOUG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="想要邊撸鐵邊學CODE的DOUG" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">想要邊撸鐵邊學CODE的DOUG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">快樂每一天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://doug0849.github.io/2021/09/16/Javascript-brick-break-game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Doug 道">
      <meta itemprop="description" content="關於轉職紀錄、技術筆記、隨寫">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="想要邊撸鐵邊學CODE的DOUG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Javascript-打磚塊遊戲實作
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-09-16 15:40:43" itemprop="dateCreated datePublished" datetime="2021-09-16T15:40:43+08:00">2021-09-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98/" itemprop="url" rel="index"><span itemprop="name">技術筆記</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong><a href="https://doug0849.github.io/javascript-brickgame-exercise">完成作品</a></strong></p>
<p>自己本身滿愛玩遊戲的，自己開始學JavaScript之後，主要都是在學如何開發網頁及如何使用JavaScript來操作網頁，透過路由來新增、讀取、更新、刪除資料庫資料…，但心裡一直想，JavaScript的運用很廣泛，不如自己來查資料看看如何來製作一款簡易的小遊戲，也來接觸不同層面的開發運用。 於似乎我找到MDN上的一個打磚塊教學，就決定先從這個小遊戲開始練習學習並記錄過程。</p>
<span id="more"></span>

<h1 id="第一步：認識canvas"><a href="#第一步：認識canvas" class="headerlink" title="第一步：認識canvas"></a>第一步：認識canvas</h1><h2 id="canvas-說明"><a href="#canvas-說明" class="headerlink" title="canvas 說明"></a>canvas 說明</h2><p>它看起來有點像 <code>&lt;img&gt;</code> 元素，其中的差異點在於 <code>&lt;canvas&gt;</code> 沒有 src 和 alt 屬性，<code>&lt;canvas&gt;</code> 只有 width 與 height 這兩個屬性，這兩個屬性皆為非必須、能透過 DOM屬性設定；若是沒有設定 width 和 height 屬性，畫布寬預設值為 300 pixels、高預設值為 150 pixels，我們也可以用 CSS 強制設定元素尺寸，但當渲染時，影像會縮放以符合元素的尺寸。</p>
<blockquote>
<p>Note:如果繪圖結果看起來有些扭曲，可以改試著用<code>&lt;canvas&gt;</code>自身的width和height屬性而不要用CSS來設定寬高。</p>
</blockquote>
<p>需要<code>&lt;/canvas&gt;</code>結束標籤</p>
<p><code>&lt;canvas&gt;</code>產生一個固定大小的繪圖畫布，這個畫布上有一或多個渲染環境(rendering context)，我們可以用渲染環境來產生或操作顯示內容的渲染環境(rendering context)。<br>不同環境(context)可能會提供不同型態的渲染方式，好比說WebGL使用OpenGL ES的3D環境(context)，而這裡我們主要將討論2D渲染環境(rendering context)。</p>
<p>一開始canvas為空白，程式碼腳本需要先存取渲染環境，在上面繪圖，然後才會顯現影像。<br><code>&lt;canvas&gt;</code> 素有一個方法(method)叫getContext()，透過此方法可以取得渲染環境及其繪圖函數(function)；<br><strong>getContext()輸入參數只有渲染環境類型一項</strong>，像本教學所討論的2D繪圖，就是輸入”2d”。</p>
<h2 id="Canvas基礎"><a href="#Canvas基礎" class="headerlink" title="Canvas基礎"></a>Canvas基礎</h2><p>我們將<code>&lt;canvas&gt;</code>元件的參考存成變數canvas為了未來使用。建立ctx變數儲存”2D渲染環境”，ctx變數實際拿來繪製Canvas的工具。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#myCanvas&#x27;</span>) <span class="comment">// 取得渲染畫布位置</span></span><br><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>) <span class="comment">// 宣告為2d渲染環境</span></span><br></pre></td></tr></table></figure>

<p>先在canvas上印出紅色正方形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 開始畫路徑</span></span><br><span class="line">ctx.beginPath() </span><br><span class="line"><span class="comment">// (x, y, width, height) </span></span><br><span class="line"><span class="comment">// 從canvas畫布起點(左上角為0,0)，向右移動20，向下移動40，劃出矩形50 x50</span></span><br><span class="line">ctx.rect(<span class="number">20</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">50</span>) </span><br><span class="line">ctx.fillStyle = <span class="string">&quot;#FF0000&quot;</span> <span class="comment">// 填充顏色設定</span></span><br><span class="line">ctx.fill() <span class="comment">// 填充</span></span><br><span class="line">ctx.closePath() <span class="comment">// 有開始有結束，封閉路徑</span></span><br></pre></td></tr></table></figure>

<p>不止矩形，也可以印出綠色的圓形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctx.beginPath();</span><br><span class="line">ctx.arc(<span class="number">240</span>, <span class="number">160</span>, <span class="number">20</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">ctx.fillStyle = <span class="string">&quot;green&quot;</span>;</span><br><span class="line">ctx.fill();</span><br><span class="line">ctx.closePath();</span><br></pre></td></tr></table></figure>

<p>arc用到六個參數</p>
<ul>
<li>圓弧中心的x、y座標</li>
<li>圓弧的半徑</li>
<li>圓弧開始和結束的角度(從開始到結束的角度, 以弧度表示)</li>
<li>繪製的方向(false代表順時針方向, 預設或true為逆時針方向) 最後一個參數並非必要</li>
</ul>
<p>fillStyle 也可以像CSS一樣可以用16進位、顏色關鍵字、rgba()函式等其他可用的顏色指定方法。</p>
<p>不但有fill() 填滿圖形，還有 stroke() 專門為外輪廓線上色</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctx.beginPath();</span><br><span class="line">ctx.rect(<span class="number">160</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">40</span>);</span><br><span class="line">ctx.strokeStyle = <span class="string">&quot;rgba(0, 0, 255, 0.5)&quot;</span>;</span><br><span class="line">ctx.stroke();</span><br><span class="line">ctx.closePath();</span><br></pre></td></tr></table></figure>


<h1 id="第二步：讓球移動"><a href="#第二步：讓球移動" class="headerlink" title="第二步：讓球移動"></a>第二步：讓球移動</h1><h2 id="定義一個繪製用的迴圈"><a href="#定義一個繪製用的迴圈" class="headerlink" title="定義一個繪製用的迴圈"></a>定義一個繪製用的迴圈</h2><p>藉由繪製球在螢幕上然後再清除，然後在每個影格中繪製球在偏移一點點的位置上（如果在同一個位置上就等於沒動），造成物體移動的感覺，就如同電影中物體移動的方式。<br>所以先定義一個繪製用的迴圈</p>
<p>為了固定更新 canvas 繪圖區域的每一個影格，我們需要定義一個繪製函式（drawing function），它將會重複執行，用不同的變數改變球的位置或其他物的位置。<br>重複執行一個函式，可以使用 JavaScript timing function，像是 setInterval() 或是 requestAnimationFrame().</p>
<p>畫一個圓，draw()函數每十毫秒會被setInterval執行一次:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.beginPath();</span><br><span class="line">  ctx.arc(<span class="number">50</span>, <span class="number">50</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>);</span><br><span class="line">  ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span>;</span><br><span class="line">  ctx.fill();</span><br><span class="line">  ctx.closePath();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(draw, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>setInterval 會無限循環， draw() 函數會以每 10 毫秒被呼叫一次除非我們將它停止。</p>
<h2 id="讓球動起來"><a href="#讓球動起來" class="headerlink" title="讓球動起來"></a>讓球動起來</h2><p>目前球沒移動，因為它不斷在原本位置更新，所以看不出來。<br>先定義四個新變數</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = canvas.width / <span class="number">2</span>; <span class="comment">// 定義畫面中間位置</span></span><br><span class="line"><span class="keyword">let</span> y = canvas.height - <span class="number">30</span>; <span class="comment">// 定義畫面由下往上30位置</span></span><br><span class="line"><span class="keyword">const</span> dx = <span class="number">2</span>; <span class="comment">// 定義球的移動X軸</span></span><br><span class="line"><span class="keyword">const</span> dy = -<span class="number">2</span>; <span class="comment">// 定義球的移動Y軸</span></span><br></pre></td></tr></table></figure>

<p>然後修改原本球的起始位置，然後再最後加上 x += dx , y += dy</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(x, y, <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>)</span><br><span class="line">  ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">  ctx.fill()</span><br><span class="line">  ctx.closePath()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(draw, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>執行後球變成像畫線似的</p>
<h2 id="在每個影格開始前清除canvas"><a href="#在每個影格開始前清除canvas" class="headerlink" title="在每個影格開始前清除canvas"></a>在每個影格開始前清除canvas</h2><p>要將canvas 清除掉可以使用 clearRect().<br>clearRect()需要 4個參數: </p>
<ul>
<li>前兩個參數代表了長方形左上角的 x和 y座標</li>
<li>後兩個參數代表了長方形右下角的 x 和 y 座標</li>
</ul>
<p>之前在這長方形範圍內所繪製的東西將會被清除掉。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(x, y, <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>)</span><br><span class="line">  ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">  ctx.fill()</span><br><span class="line">  ctx.closePath()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(draw, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>球沒有留下痕跡了。每 10 毫秒 canvas 會被清除，新的球將會被畫在指定的新位置上，且 x 和 y 會更新以用在下一個影格.</p>
<h2 id="整理程式碼"><a href="#整理程式碼" class="headerlink" title="整理程式碼"></a>整理程式碼</h2><p>把畫球獨立設為一個函式，因為這個函式會不斷地被使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#myCanvas&#x27;</span>) <span class="comment">// 取得渲染畫布位置</span></span><br><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>) <span class="comment">// 宣告為2d渲染環境</span></span><br><span class="line"><span class="keyword">let</span> x = canvas.width / <span class="number">2</span>; <span class="comment">// 定義畫面中間位置</span></span><br><span class="line"><span class="keyword">let</span> y = canvas.height - <span class="number">30</span>; <span class="comment">// 定義畫面由下往上30位置</span></span><br><span class="line"><span class="keyword">const</span> dx = <span class="number">2</span>; <span class="comment">// 定義球一開始向右移動的X距離</span></span><br><span class="line"><span class="keyword">const</span> dy = -<span class="number">2</span>; <span class="comment">// 定義球一開始向上移動的Y距離</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBall</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(x, y, <span class="number">10</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>)</span><br><span class="line">  ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">  ctx.fill()</span><br><span class="line">  ctx.closePath()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  drawBall()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(draw, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h1 id="第三步：讓球反彈吧"><a href="#第三步：讓球反彈吧" class="headerlink" title="第三步：讓球反彈吧!"></a>第三步：讓球反彈吧!</h1><h2 id="簡單的碰撞偵測"><a href="#簡單的碰撞偵測" class="headerlink" title="簡單的碰撞偵測"></a>簡單的碰撞偵測</h2><p>為了偵測碰撞的發生，我們將檢查球是否接觸(相撞)牆壁，如果有碰到，我們就改變球的行進方向。<br>為了方便計算，宣告一個新變數 ballRadius 代表球的半徑，然後更新畫球的半徑。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ballRadius = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>總共有四面牆壁會與球發生碰撞，先處理上方的牆壁：<br>在每個影格檢查球是否有接觸到 Canvas 上方壁面 —如果是的話，我們將扭轉球的運動，所以它將開始在相反的方向移動，並保持在可見邊界。記住坐標是從左上角開始，我們可以得到這樣的東西：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(y + dy &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>單純看垂直Y軸移動方向，因為向上是負數，最上方為0，如果球位置的Y值低於零，就改變Y軸的運動的方向，可以再次宣告它本身來轉換。<br>依此類推可以推出，下方邊界</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(y + dy &gt; canvas.height) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>兩語句可以合併</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(y + dy &gt; canvas.height || y + dy &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>依此類推X軸就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(x + dx &gt; canvas.width || x + dx &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加入draw()裡面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width || x + dx &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &gt; canvas.height || y + dy &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125;</span><br><span class="line">  drawBall()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這時候球就會反彈啦! ，但是會發現求超出畫面半顆，因為是以球心做為判斷，這時候要在邊界上扣掉和增加球的半徑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &gt; canvas.height - ballRadius || y + dy &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125;</span><br><span class="line">  drawBall()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第四步：控制球版"><a href="#第四步：控制球版" class="headerlink" title="第四步：控制球版"></a>第四步：控制球版</h1><p>目前還無法跟畫面互動，如果沒有互動，怎麼稱作遊戲!</p>
<h2 id="畫球拍"><a href="#畫球拍" class="headerlink" title="畫球拍"></a>畫球拍</h2><p>所以我們這時需要一個球拍，先定義一些變數，定義球拍的長和寬，和球拍X軸上的初始位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> paddleHeight = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> paddleWidth = <span class="number">75</span>;</span><br><span class="line"><span class="keyword">let</span> paddleX = (canvas.width-paddleWidth)/<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>接著把球拍畫出來</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawPaddle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ctx.beginPath()</span><br><span class="line">    ctx.rect(paddleX, canvas.height-paddleHeight, paddleWidth, paddleHeight);</span><br><span class="line">    ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">    ctx.fill()</span><br><span class="line">    ctx.closePath()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="允許用戶控制球版"><a href="#允許用戶控制球版" class="headerlink" title="允許用戶控制球版"></a>允許用戶控制球版</h2><p>我們需要：<br>兩個變量以保存左右方向鍵是否被按下的信息。<br>兩個事件監控器來捕捉按鈕的按下動作。我們需要運行一些代碼以在被按下時可以控制球拍的移動<br>兩個用於處理被按下或按鈕後的事件方法來實現左右移動球拍</p>
<p>可以使用 boolean 變量來初始定義。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rightPressed = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> leftPressed = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>這兩個變量的兩個默認值都是false，因為在開始時沒有任何案件被按下。<br>接著要監聽手勢的點擊動作，需要添加監聽器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;keydown&quot;</span>, keyDownHandler) <span class="comment">// 監聽按下鍵，按下按鍵時執行keyDownHandler函式</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;keyup&quot;</span>, keyUpHandler) <span class="comment">// 監聽放開鍵，放開按鍵時執行keyUpHandler函式</span></span><br></pre></td></tr></table></figure>

<p>並新增keyDownHandler及keyUpHandler兩個函式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyDownHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 假設按下的按鈕是右鍵，則把rightPressed函數設為true</span></span><br><span class="line">  <span class="keyword">if</span> (e.keyCode == <span class="number">39</span>) &#123;</span><br><span class="line">    rightPressed = <span class="literal">true</span></span><br><span class="line">  &#125;<span class="comment">// 假設按下的按鈕是左鍵，則把rightPressed函數設為true</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (e.keyCode == <span class="number">37</span>) &#123;</span><br><span class="line">    leftPressed = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyUpHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 假設放開的按鈕是右鍵，則把rightPressed函數設為false</span></span><br><span class="line">  <span class="keyword">if</span> (e.keyCode == <span class="number">39</span>) &#123;</span><br><span class="line">    rightPressed = <span class="literal">false</span></span><br><span class="line">  &#125;<span class="comment">// 假設放開的按鈕是左鍵，則把rightPressed函數設為false</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (e.keyCode == <span class="number">37</span>) &#123;</span><br><span class="line">    leftPressed = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>總而言之，不管按下或放開，都要監聽，監聽後還要判斷按下或放開哪一顆鍵，都要設定。</p>
<h2 id="球版控制邏輯"><a href="#球版控制邏輯" class="headerlink" title="球版控制邏輯"></a>球版控制邏輯</h2><p>現在有用於存儲按鍵，事件監聽器和相關功能的信息的變量。<br>接著在draw（）函數內部，每一幀被渲染的同時監測是否按下了左或右鍵。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rightPressed) &#123;</span><br><span class="line">   paddleX += <span class="number">7</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed) &#123;</span><br><span class="line">   paddleX -= <span class="number">7</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>如果按一下左鍵，球拍將向左移動7個像素，如果按一下右鍵，球拍將向右移動7個像素。<br>但是球拍會移出畫布然後消失，所以改一下判斷，另外方形的起始點是方形的左下角，也同樣是作為心點，所以要以左下角的點為中心點來做判斷。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="第五步：Game-Over，及接球"><a href="#第五步：Game-Over，及接球" class="headerlink" title="第五步：Game Over，及接球"></a>第五步：Game Over，及接球</h1><h2 id="Game-Over"><a href="#Game-Over" class="headerlink" title="Game Over"></a>Game Over</h2><p>目前遊戲永無止盡，所以要修改一下牆壁反彈的規則，當球從下方離開畫布時，就跳出警示，並重新開始遊戲。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( y + dy &lt; <span class="number">0</span> + ballRadius ) &#123; <span class="comment">// 從此處開始修改</span></span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( y + dy &gt; canvas.height - ballRadius ) &#123;</span><br><span class="line">    alert(<span class="string">&#x27;Game Over&#x27;</span>)</span><br><span class="line">    <span class="built_in">document</span>.location.reload()</span><br><span class="line">  &#125;<span class="comment">// 從此處結束</span></span><br><span class="line">  <span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  drawBall()</span><br><span class="line">  drawPaddle()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接球"><a href="#接球" class="headerlink" title="接球"></a>接球</h2><p>最後球和球拍之間要創建一些碰撞檢測，使它可以反彈並返回到遊戲區域。<br>最簡單的方法是檢查球落下後，球心的x值是否在球拍的左邊和右邊之間。<br>可以這麼做</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  <span class="comment">// 如果球碰到畫布邊界就反轉</span></span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果球碰到畫布上邊界就反轉，下邊界則判斷是否落在球板內</span></span><br><span class="line">  <span class="keyword">if</span> ( y + dy &lt; <span class="number">0</span> + ballRadius ) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( y + dy &gt; canvas.height - ballRadius ) &#123; <span class="comment">// 當球落下</span></span><br><span class="line">    <span class="keyword">if</span> ( x &gt; paddleX &amp;&amp; x &lt; paddleX + paddleWidth) &#123; <span class="comment">// 再增加一個判斷，如果球在球板範圍內則反轉</span></span><br><span class="line">      dy = -dy</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(<span class="string">&#x27;Game Over&#x27;</span>)</span><br><span class="line">      <span class="built_in">document</span>.location.reload()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判斷是否有按下鍵盤，有的話移動球板位置</span></span><br><span class="line">  <span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  drawBall()</span><br><span class="line">  drawPaddle()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第六步：畫磚-重要"><a href="#第六步：畫磚-重要" class="headerlink" title="第六步：畫磚 (重要!)"></a>第六步：畫磚 (重要!)</h1><p>只有彈接球有點無聊，加上磚來增添遊戲趣味。<br>一開始先定義磚的基本資料：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> brickRowCount = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> brickColumnCount = <span class="number">5</span></span><br><span class="line"><span class="keyword">const</span> brickWidth = <span class="number">75</span></span><br><span class="line"><span class="keyword">const</span> brickHeight = <span class="number">20</span></span><br><span class="line"><span class="keyword">const</span> brickPadding = <span class="number">10</span></span><br><span class="line"><span class="keyword">const</span> brickOffsetTop = <span class="number">30</span></span><br><span class="line"><span class="keyword">const</span> brickOffsetLeft = <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>定義了磚的行數和列，寬度和高度，磚塊之間的距離，這樣它們就不會互相接觸；有一個上、左偏移量，就不會從畫布的邊緣開始繪製。</p>
<h2 id="畫磚的邏輯"><a href="#畫磚的邏輯" class="headerlink" title="畫磚的邏輯"></a>畫磚的邏輯</h2><p>我們將在一個二維數組容納我們所有的磚。<br>它將包含磚列（c），磚行（R），每一個包含一個物件，物件內包含x和y的座標，讓每個磚顯示在屏幕上。在變量下面添加以下代碼：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bricks = [];</span><br><span class="line"><span class="keyword">for</span>(c=<span class="number">0</span>; c&lt;brickColumnCount; c++) &#123;</span><br><span class="line">    bricks[c] = [];</span><br><span class="line">    <span class="keyword">for</span>(r=<span class="number">0</span>; r&lt;brickRowCount; r++) &#123;</span><br><span class="line">        bricks[c][r] = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>bricks是一個雙層陣列，陣列裡還有數組表示Column的陣列，，Column的陣列裡面有數組物件，代表Row，<br>目前我們先使用for迴圈將磚的座標宣告出來。</p>
<img src="/2021/09/16/Javascript-brick-break-game/1.png" class="">

<table>
<thead>
<tr>
<th></th>
<th>C0</th>
<th>C1</th>
<th>C2</th>
<th>C3</th>
<th>C4</th>
</tr>
</thead>
<tbody><tr>
<td>R0</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
</tr>
<tr>
<td>R1</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
</tr>
<tr>
<td>R2</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
<td>x,y</td>
</tr>
</tbody></table>
<p>接著我們創建一個函數來遍歷數組中的所有磚塊並在屏幕上繪製它們。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBricks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(c=<span class="number">0</span>; c&lt;brickColumnCount; c++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(r=<span class="number">0</span>; r&lt;brickRowCount; r++) &#123;</span><br><span class="line">            bricks[c][r].x = <span class="number">0</span>;</span><br><span class="line">            bricks[c][r].y = <span class="number">0</span>;</span><br><span class="line">            ctx.beginPath();</span><br><span class="line">            ctx.rect(<span class="number">0</span>, <span class="number">0</span>, brickWidth, brickHeight);</span><br><span class="line">            ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span>;</span><br><span class="line">            ctx.fill();</span><br><span class="line">            ctx.closePath();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>現在會將所有的磚畫出可是它只會畫在同個位置上，所以要加上一些變數，來改變磚的x和y</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft</span><br><span class="line"><span class="keyword">let</span> brickY = (r*(brickHeight+brickPadding))+brickOffsetTop</span><br></pre></td></tr></table></figure>

<p>每個brickX位置是 brickWidth + brickPadding，乘以列數C，再加上brickOffsetLeft；<br>以此類推，brickY的邏輯相同，除了名稱不同，使用行數R，brickHeight，和brickOffsetTop。</p>
<p>現在把變數套進函式內，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBricks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(c=<span class="number">0</span>; c&lt;brickColumnCount; c++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(r=<span class="number">0</span>; r&lt;brickRowCount; r++) &#123;</span><br><span class="line">          <span class="keyword">let</span> brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft</span><br><span class="line">          <span class="keyword">let</span> brickY = (r*(brickHeight+brickPadding))+brickOffsetTop</span><br><span class="line">          bricks[c][r].x = brickX</span><br><span class="line">          bricks[c][r].y = brickY</span><br><span class="line">          ctx.beginPath()</span><br><span class="line">          ctx.rect(brickX, brickY, brickWidth, brickHeight)</span><br><span class="line">          ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">          ctx.fill()</span><br><span class="line">          ctx.closePath()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這樣每一塊磚就會被畫在正確的位置上，每一塊磚之間也都有間隔，且是從左上角和頂部的畫布邊緣偏移。</p>
<h1 id="第七步：打破磚"><a href="#第七步：打破磚" class="headerlink" title="第七步：打破磚"></a>第七步：打破磚</h1><p>邏輯是必須在每塊磚一開始給個Key跟Value，添加一個物件KEY表示狀態，值則是讓磚塊有被打破，及沒被打破兩種值，可以用0,1處裡，接著當球如果通過磚要達成以下條件：</p>
<ul>
<li>球的 X 位置大於磚的 X 位置。</li>
<li>球的 X 位置小於磚的 X 位置加上它的寬度。</li>
<li>球的 Y 位置大於磚的Y位置。</li>
<li>球的 Y 位置小於磚塊的 Y 位置加上它的高度。<br>代表磚塊被撞擊了，接著重新設定磚塊屬性，當重新渲染畫面的時候，不渲染屬性屬於消失的磚塊</li>
</ul>
<p>所以</p>
<h2 id="先添加屬性"><a href="#先添加屬性" class="headerlink" title="先添加屬性"></a>先添加屬性</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bricks = [];</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; brickColumnCount; c++) &#123;</span><br><span class="line">  bricks[c] = [];</span><br><span class="line">  <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; brickRowCount; r++) &#123;</span><br><span class="line">    bricks[c][r] = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>, <span class="attr">status</span>: <span class="number">1</span> &#125;; <span class="comment">// 先加上一個新key-value，1表示未被打擊</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著畫磚函示加上判斷</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawBricks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; brickColumnCount; c++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; brickRowCount; r++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (bricks[c][r].status === <span class="number">1</span>) &#123; <span class="comment">// 補上狀態等於1，才進行繪製</span></span><br><span class="line">        <span class="keyword">let</span> brickX = (c * (brickWidth + brickPadding)) + brickOffsetLeft</span><br><span class="line">        <span class="keyword">let</span> brickY = (r * (brickHeight + brickPadding)) + brickOffsetTop</span><br><span class="line">        bricks[c][r].x = brickX</span><br><span class="line">        bricks[c][r].y = brickY</span><br><span class="line">        ctx.beginPath()</span><br><span class="line">        ctx.rect(brickX, brickY, brickWidth, brickHeight)</span><br><span class="line">        ctx.fillStyle = <span class="string">&quot;#0095DD&quot;</span></span><br><span class="line">        ctx.fill()</span><br><span class="line">        ctx.closePath()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最後補上判斷磚塊是否被打擊函式，邏輯：當磚球都被繪製出位置之後，遍歷所有的磚塊，檢查是否有被擊中，若有就將Y方向反轉，並將磚塊的狀態設定成0。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collisionDetection</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(c=<span class="number">0</span>; c&lt;brickColumnCount; c++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(r=<span class="number">0</span>; r&lt;brickRowCount; r++) &#123;</span><br><span class="line">            <span class="keyword">var</span> b = bricks[c][r]</span><br><span class="line">            <span class="keyword">if</span>(x &gt; b.x &amp;&amp; x &lt; b.x+brickWidth &amp;&amp; y &gt; b.y &amp;&amp; y &lt; b.y+brickHeight) &#123;</span><br><span class="line">                dy = -dy</span><br><span class="line">                b.status = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最後在draw()中調用函式，切記要在drawBall及drawBrick之後。</p>
<h1 id="第八步：計算分數及獲勝"><a href="#第八步：計算分數及獲勝" class="headerlink" title="第八步：計算分數及獲勝"></a>第八步：計算分數及獲勝</h1><p>邏輯：存一個變數計算分數，然後在磚塊碰撞檢測函數增加，分數增加，然後設定一個獲勝判斷函式，當分數達到多少分時贏得勝利。<br>優化：在畫面上顯示分數。</p>
<p>目前畫面，先來設定記分板的位置</p>
<img src="/2021/09/16/Javascript-brick-break-game/2.png" class="">

<p>完成畫面</p>
<img src="/2021/09/16/Javascript-brick-break-game/3.png" class="">


<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collisionDetection</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; brickColumnCount; c++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; brickRowCount; r++) &#123;</span><br><span class="line">      <span class="keyword">let</span> b = bricks[c][r]</span><br><span class="line">      <span class="keyword">if</span> (b.status == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; b.x &amp;&amp; x &lt; b.x + brickWidth &amp;&amp; y &gt; b.y &amp;&amp; y &lt; b.y + brickHeight) &#123;</span><br><span class="line">          dy = -dy;</span><br><span class="line">          b.status = <span class="number">0</span>;</span><br><span class="line">          score += <span class="number">10</span>; <span class="comment">// 加上這個，每個磚塊10分</span></span><br><span class="line">          showScore.innerText = score <span class="comment">// 跟加上這個 要先設定HTML及在一開始宣告常數抓取位置</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>設定好獲勝時的勝利畫面<br>然後在Css設定 display:none 來隱藏</p>
<p>JS加入獲勝判斷函式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">detectionWin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 當分數達到所有磚塊數量 * 每個磚塊的分數，也不等於0的時候</span></span><br><span class="line">  <span class="keyword">if</span> (score === bricks.length * bricks[<span class="number">0</span>].length * <span class="number">10</span> &amp;&amp; score !== <span class="number">0</span>) &#123;</span><br><span class="line">    winText.style.display = <span class="string">&quot;block&quot;</span>; <span class="comment">// 把獲勝的區塊樣式設定display設定成block顯示</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/2021/09/16/Javascript-brick-break-game/4.png" class="">


<h1 id="第九步：滑鼠監測"><a href="#第九步：滑鼠監測" class="headerlink" title="第九步：滑鼠監測"></a>第九步：滑鼠監測</h1><p>只需要利用滑鼠移動監聽器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;mousemove&quot;</span>, mouseMoveHandler);</span><br></pre></td></tr></table></figure>

<p>然後加上mosuMoveHandler函式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mouseMoveHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> relativeX = e.clientX - canvas.offsetLeft</span><br><span class="line">    <span class="keyword">if</span>(relativeX &gt; <span class="number">0</span> &amp;&amp; relativeX &lt; canvas.width) &#123;</span><br><span class="line">        paddleX = relativeX - paddleWidth/<span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在這個函數中，我們首先計算 relativeX 的值，它等於鼠標在視窗中的水平位置 (e.clientX) 減去 canvas 元素左邊框到視窗左邊框的距離 (canvas.offsetLeft) —— 這就得到了 canvas 元素左邊框到鼠標的距離。若這個值大於零，且小於 canvas 的寬度，說明鼠標指針落在 canvas 邊界內，這時就把 paddleX （等於球板左邊緣的坐標）設為 relativeX 減去球板寬度的一半。這樣就確保位移是相對於球板中心進行的。</p>
<img src="/2021/09/16/Javascript-brick-break-game/5.png" class="">

<h1 id="第十步：部分優化"><a href="#第十步：部分優化" class="headerlink" title="第十步：部分優化"></a>第十步：部分優化</h1><ol>
<li>隨機開始發球的方向</li>
<li>增加勝利畫面</li>
<li>增加輸畫面</li>
<li>增加生命次數</li>
<li>增加出界線</li>
</ol>
<p>完成畫面</p>
<img src="/2021/09/16/Javascript-brick-break-game/6.png" class="">

<h3 id="setInterval改為requestAnimationFrame進行優化渲染"><a href="#setInterval改為requestAnimationFrame進行優化渲染" class="headerlink" title="setInterval改為requestAnimationFrame進行優化渲染"></a>setInterval改為requestAnimationFrame進行優化渲染</h3><ol start="6">
<li>將原本的setInterval改為新版的requestAnimationFrame進行優化渲染<br>用requestAnimationFrame是因為瀏覽器會自動每秒60偵進行畫面渲染，當不在瀏覽視窗的時候，會自動停止渲染，不占用CPU。</li>
</ol>
<p>首先先在頁頭宣告一個變數 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> render = <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>再來將原本任何關於Interval的部分全部刪除，包含停止渲染clearInterval都要刪除，這時候不管輸贏都不會停止了</p>
<p>再來說說requestAnimationFrame的使用方式<br>它是一個callback函式，所以必須要把它放在draw函式最後並調用它，並且將draw作為參數帶入，最後將他賦予給一開始定義為null的 <strong>render</strong> 變數</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  detectionWin()</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y + dy &gt; canvas.height - ballRadius * <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; paddleX &amp;&amp; x &lt; paddleX + paddleWidth) &#123;</span><br><span class="line">      dy = -dy</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!lives) &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(interval) <span class="comment">// 輸了之後停止，這段刪除</span></span><br><span class="line">        loseText.style.display = <span class="string">&quot;block&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        lives--</span><br><span class="line">        x = canvas.width / <span class="number">2</span>;</span><br><span class="line">        y = canvas.height - <span class="number">30</span>;</span><br><span class="line">        dx = <span class="number">5</span> * (<span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random()) * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        dy = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * -<span class="number">3</span>) - <span class="number">2</span></span><br><span class="line">        paddleX = (canvas.width - paddleWidth) / <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render = requestAnimationFrame(draw) <span class="comment">// 最後加入這段</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>接著來修改監聽Enter的函式keyDownHandler()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyDownHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.key === <span class="string">&quot;Enter&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!render) &#123; <span class="comment">// 由原本的interval 改為 render</span></span><br><span class="line">      draw() <span class="comment">// 如果render是空的話，就執行畫圖渲染計算</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      initial()</span><br><span class="line">      draw() <span class="comment">// 原本拿掉了interval，這邊要放回draw()</span></span><br><span class="line">      loseText.style.display = <span class="string">&quot;none&quot;</span></span><br><span class="line">      winText.style.display = <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (e.keyCode == <span class="number">39</span>) &#123;</span><br><span class="line">    rightPressed = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (e.keyCode == <span class="number">37</span>) &#123;</span><br><span class="line">    leftPressed = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以目前遊戲的邏輯是</p>
<ol>
<li>遊戲初始畫畫面(停止)</li>
<li>render = null</li>
<li>按下Enter後呼叫draw()，並且draw() 會 render = requestAnimationFrame(draw)</li>
<li>等待輸贏</li>
</ol>
<p>接著就是要等待輸贏，不管贏或輸都要停止渲染，這邊接著說明 requestAnimationFrame() 停止的使用方式</p>
<h3 id="requestAnimationFrame-的停止方式為-cancelAnimationFrame"><a href="#requestAnimationFrame-的停止方式為-cancelAnimationFrame" class="headerlink" title="requestAnimationFrame()的停止方式為 cancelAnimationFrame()"></a>requestAnimationFrame()的停止方式為 cancelAnimationFrame()</h3><p>但要使用用cancelAnimationFrame()這個函式來停止requestAnimationFrame()有一個條件，<br><strong>就是 requestAnimationFrame() 當初有給他一個變數名稱</strong><br>所以本案案例就是render，這邊我將render帶入，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cancelAnimationFrame(render)</span><br></pre></td></tr></table></figure>
<p>並將他放判斷輸贏的部分，一旦取消後，要再次將 render = null</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 贏的部分</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">detectionWin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (score === bricks.length * bricks[<span class="number">0</span>].length * <span class="number">10</span> &amp;&amp; score !== <span class="number">0</span>) &#123;</span><br><span class="line">    cancelAnimationFrame(render) <span class="comment">// 原本的clearInterval刪除，並且加入這端</span></span><br><span class="line">    render = <span class="literal">null</span> <span class="comment">// 別忘了把render 轉回 null</span></span><br><span class="line">    winText.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 輸的部分</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  detectionWin()</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y + dy &gt; canvas.height - ballRadius * <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; paddleX &amp;&amp; x &lt; paddleX + paddleWidth) &#123;</span><br><span class="line">      dy = -dy</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!lives) &#123;</span><br><span class="line">        cancelAnimationFrame(render) <span class="comment">// 原本的clearInterval刪除，並且加入這端</span></span><br><span class="line">        render = <span class="literal">null</span> <span class="comment">// 別忘了把render 轉回 null</span></span><br><span class="line">        loseText.style.display = <span class="string">&quot;block&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        lives--</span><br><span class="line">        x = canvas.width / <span class="number">2</span>;</span><br><span class="line">        y = canvas.height - <span class="number">30</span>;</span><br><span class="line">        dx = <span class="number">5</span> * (<span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random()) * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        dy = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * -<span class="number">3</span>) - <span class="number">2</span></span><br><span class="line">        paddleX = (canvas.width - paddleWidth) / <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  drawBoundary()</span><br><span class="line">  drawLives()</span><br><span class="line">  drawBricks()</span><br><span class="line">  drawBall()</span><br><span class="line">  drawPaddle()</span><br><span class="line">  collisionDetection()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>都設定完畢了，但是發現為什麼畫面還是沒有停止渲染!?!?!?<br>這個地方我搞了老半天，以為是函示使用錯誤，最後發現問題在這</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">detectionWin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (score === bricks.length * bricks[<span class="number">0</span>].length * <span class="number">10</span> &amp;&amp; score !== <span class="number">0</span>) &#123;</span><br><span class="line">    cancelAnimationFrame(render) </span><br><span class="line">    render = <span class="literal">null</span> </span><br><span class="line">    winText.style.display = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  detectionWin() <span class="comment">// !!!!!!!!!!!!!!!!!!!你就是兇手!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y + dy &gt; canvas.height - ballRadius * <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; paddleX &amp;&amp; x &lt; paddleX + paddleWidth) &#123;</span><br><span class="line">      dy = -dy</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!lives) &#123;</span><br><span class="line">        cancelAnimationFrame(render) </span><br><span class="line">        render = <span class="literal">null</span> </span><br><span class="line">        loseText.style.display = <span class="string">&quot;block&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        lives--</span><br><span class="line">        x = canvas.width / <span class="number">2</span>;</span><br><span class="line">        y = canvas.height - <span class="number">30</span>;</span><br><span class="line">        dx = <span class="number">5</span> * (<span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random()) * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        dy = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * -<span class="number">3</span>) - <span class="number">2</span></span><br><span class="line">        paddleX = (canvas.width - paddleWidth) / <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  drawBoundary()</span><br><span class="line">  drawLives()</span><br><span class="line">  drawBricks()</span><br><span class="line">  drawBall()</span><br><span class="line">  drawPaddle()</span><br><span class="line">  collisionDetection()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因出在，當我draw()調用detectionWin()後並沒有return，所以程式又繼續執行下去了!!<br>所以這時候我們要改改函式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">detectionWin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (score === bricks.length * bricks[<span class="number">0</span>].length * <span class="number">10</span> &amp;&amp; score !== <span class="number">0</span>) &#123;</span><br><span class="line">    winText.style.display = <span class="string">&quot;block&quot;</span>; <span class="comment">//前面拿掉cancelAnimationFrame(render)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 回傳 true</span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height)</span><br><span class="line">  <span class="comment">// 設一個判斷在此，並將將detectionWin()的回傳值傳入，這時候如果是true，就會停止渲染，並把render = null，並return，如果沒有贏，就繼續下去。</span></span><br><span class="line">  <span class="keyword">if</span> (detectionWin()) &#123;</span><br><span class="line">    cancelAnimationFrame(render) </span><br><span class="line">    render = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x + dx &gt; canvas.width - ballRadius || x + dx &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dx = -dx;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (y + dy &lt; <span class="number">0</span> + ballRadius) &#123;</span><br><span class="line">    dy = -dy;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y + dy &gt; canvas.height - ballRadius * <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; paddleX &amp;&amp; x &lt; paddleX + paddleWidth) &#123;</span><br><span class="line">      dy = -dy</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!lives) &#123;</span><br><span class="line">        cancelAnimationFrame(render) </span><br><span class="line">        render = <span class="literal">null</span> </span><br><span class="line">        loseText.style.display = <span class="string">&quot;block&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        lives--</span><br><span class="line">        x = canvas.width / <span class="number">2</span>;</span><br><span class="line">        y = canvas.height - <span class="number">30</span>;</span><br><span class="line">        dx = <span class="number">5</span> * (<span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random()) * <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">        dy = <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * -<span class="number">3</span>) - <span class="number">2</span></span><br><span class="line">        paddleX = (canvas.width - paddleWidth) / <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (rightPressed &amp;&amp; paddleX &lt; canvas.width - paddleWidth) &#123;</span><br><span class="line">    paddleX += <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (leftPressed &amp;&amp; paddleX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    paddleX -= <span class="number">7</span></span><br><span class="line">  &#125;</span><br><span class="line">  drawBoundary()</span><br><span class="line">  drawLives()</span><br><span class="line">  drawBricks()</span><br><span class="line">  drawBall()</span><br><span class="line">  drawPaddle()</span><br><span class="line">  collisionDetection()</span><br><span class="line">  x += dx</span><br><span class="line">  y += dy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>大功告成!!</strong></p>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98/" rel="tag"># 技術筆記</a>
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
              <a href="/tags/Game/" rel="tag"># Game</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/15/s2-layout-tshirt-shop/" rel="prev" title="S2-切版練習-T恤商店">
      <i class="fa fa-chevron-left"></i> S2-切版練習-T恤商店
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/18/collect-blog-data/" rel="next" title="蒐集部落客資料">
      蒐集部落客資料 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
<script src="https://utteranc.es/client.js"
        repo="doug0849/doug0849.github.io"
        issue-term="pathname"
        theme="photon-dark"
        crossorigin="anonymous"
        async>
</script>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E8%AA%8D%E8%AD%98canvas"><span class="nav-number">1.</span> <span class="nav-text">第一步：認識canvas</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#canvas-%E8%AA%AA%E6%98%8E"><span class="nav-number">1.1.</span> <span class="nav-text">canvas 說明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Canvas%E5%9F%BA%E7%A4%8E"><span class="nav-number">1.2.</span> <span class="nav-text">Canvas基礎</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%AE%93%E7%90%83%E7%A7%BB%E5%8B%95"><span class="nav-number">2.</span> <span class="nav-text">第二步：讓球移動</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E7%BE%A9%E4%B8%80%E5%80%8B%E7%B9%AA%E8%A3%BD%E7%94%A8%E7%9A%84%E8%BF%B4%E5%9C%88"><span class="nav-number">2.1.</span> <span class="nav-text">定義一個繪製用的迴圈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%93%E7%90%83%E5%8B%95%E8%B5%B7%E4%BE%86"><span class="nav-number">2.2.</span> <span class="nav-text">讓球動起來</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%AF%8F%E5%80%8B%E5%BD%B1%E6%A0%BC%E9%96%8B%E5%A7%8B%E5%89%8D%E6%B8%85%E9%99%A4canvas"><span class="nav-number">2.3.</span> <span class="nav-text">在每個影格開始前清除canvas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E7%90%86%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">2.4.</span> <span class="nav-text">整理程式碼</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E8%AE%93%E7%90%83%E5%8F%8D%E5%BD%88%E5%90%A7"><span class="nav-number">3.</span> <span class="nav-text">第三步：讓球反彈吧!</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B0%A1%E5%96%AE%E7%9A%84%E7%A2%B0%E6%92%9E%E5%81%B5%E6%B8%AC"><span class="nav-number">3.1.</span> <span class="nav-text">簡單的碰撞偵測</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%8E%A7%E5%88%B6%E7%90%83%E7%89%88"><span class="nav-number">4.</span> <span class="nav-text">第四步：控制球版</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%95%AB%E7%90%83%E6%8B%8D"><span class="nav-number">4.1.</span> <span class="nav-text">畫球拍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%81%E8%A8%B1%E7%94%A8%E6%88%B6%E6%8E%A7%E5%88%B6%E7%90%83%E7%89%88"><span class="nav-number">4.2.</span> <span class="nav-text">允許用戶控制球版</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%90%83%E7%89%88%E6%8E%A7%E5%88%B6%E9%82%8F%E8%BC%AF"><span class="nav-number">4.3.</span> <span class="nav-text">球版控制邏輯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9AGame-Over%EF%BC%8C%E5%8F%8A%E6%8E%A5%E7%90%83"><span class="nav-number">5.</span> <span class="nav-text">第五步：Game Over，及接球</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Game-Over"><span class="nav-number">5.1.</span> <span class="nav-text">Game Over</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E7%90%83"><span class="nav-number">5.2.</span> <span class="nav-text">接球</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E7%95%AB%E7%A3%9A-%E9%87%8D%E8%A6%81"><span class="nav-number">6.</span> <span class="nav-text">第六步：畫磚 (重要!)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%95%AB%E7%A3%9A%E7%9A%84%E9%82%8F%E8%BC%AF"><span class="nav-number">6.1.</span> <span class="nav-text">畫磚的邏輯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E6%89%93%E7%A0%B4%E7%A3%9A"><span class="nav-number">7.</span> <span class="nav-text">第七步：打破磚</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%88%E6%B7%BB%E5%8A%A0%E5%B1%AC%E6%80%A7"><span class="nav-number">7.1.</span> <span class="nav-text">先添加屬性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E8%A8%88%E7%AE%97%E5%88%86%E6%95%B8%E5%8F%8A%E7%8D%B2%E5%8B%9D"><span class="nav-number">8.</span> <span class="nav-text">第八步：計算分數及獲勝</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E6%AD%A5%EF%BC%9A%E6%BB%91%E9%BC%A0%E7%9B%A3%E6%B8%AC"><span class="nav-number">9.</span> <span class="nav-text">第九步：滑鼠監測</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E6%AD%A5%EF%BC%9A%E9%83%A8%E5%88%86%E5%84%AA%E5%8C%96"><span class="nav-number">10.</span> <span class="nav-text">第十步：部分優化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setInterval%E6%94%B9%E7%82%BArequestAnimationFrame%E9%80%B2%E8%A1%8C%E5%84%AA%E5%8C%96%E6%B8%B2%E6%9F%93"><span class="nav-number">10.0.1.</span> <span class="nav-text">setInterval改為requestAnimationFrame進行優化渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requestAnimationFrame-%E7%9A%84%E5%81%9C%E6%AD%A2%E6%96%B9%E5%BC%8F%E7%82%BA-cancelAnimationFrame"><span class="nav-number">10.0.2.</span> <span class="nav-text">requestAnimationFrame()的停止方式為 cancelAnimationFrame()</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Doug 道"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Doug 道</p>
  <div class="site-description" itemprop="description">關於轉職紀錄、技術筆記、隨寫</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/doug0849" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;doug0849" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:etaomonk@gmail.com" title="E-Mail → mailto:etaomonk@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/dlchou89" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;dlchou89" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doug 道</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
